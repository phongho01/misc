const {
  getRegistry,
  createMetadata,
  construct,
  methods,
} = require("@substrate/txwrapper-polkadot");
const axios = require("axios");
const fs = require("fs");
const { encodeAddress } = require("@polkadot/keyring");
const { listenerCount } = require("process");

const rpcToLocalNode = async (method, params = []) => {
  const response = await axios.post(
    "https://polkadot.api.onfinality.io/rpc?apikey=53879583-a0d3-48dc-ae25-9702dd3c1224",
    {
      id: 1,
      jsonrpc: "2.0",
      method,
      params,
    },
    {
      headers: {
        "Content-Type": "application/json",
        connection: "keep-alive",
      },
    }
  );
  const res = response.data;
  if (res.error) {
    console.log(error);
    throw new Error(
      `${res.error.code} ${res.error.message}: ${JSON.stringify(
        res.error.data
      )}`
    );
  }
  return res.result;
};

const sign = async () => {
  const { block } = await rpcToLocalNode("chain_getBlock");
  const blockNum = parseInt(block.header.number, 16);
  const blockHash = await rpcToLocalNode("chain_getBlockHash", [blockNum]);
  const genesisHash = await rpcToLocalNode("chain_getBlockHash", [0]);
  const { specVersion, transactionVersion, specName } = await rpcToLocalNode(
    "state_getRuntimeVersion"
  );
  if (!fs.existsSync("metadata.json")) {
    const res = await rpcToLocalNode("state_getMetadata");
    fs.writeFileSync("metadata.json", JSON.stringify({ data: res }));
  }

  const rawMetadataRpc = fs.readFileSync("metadata.json", "utf8");
  const metadataRpc = JSON.parse(rawMetadataRpc).data;

  const output = Buffer.from(metadataRpc, "hex");

  const registry = getRegistry({
    chainName: "Polkadot",
    specName,
    specVersion,
    metadataRpc,
  });

  console.log("output", metadataRpc);
};

// sign();

const obj = [
  {
    type: "[U8; 32]",
    type_name: "AccountId",
    value: "0x98fd6cd9dd4397cef7d35f684de514969ecb622dbbfad506c11b3e1838228f3a",
    name: "from",
  },
  {
    type: "[U8; 32]",
    type_name: "AccountId",
    value: "0x1850549beffb13c099820ede4a5724228681dd2f86747e82ef48d6b627483f17",
    name: "to",
  },
  {
    type: "U128",
    type_name: "Balance",
    value: "1000000000",
    name: "amount",
  },
];

const from =
  "0x0abf4e427e2bd3e9e5912e156233c5d397a74516f474713baf52a935009ee8b5"; // 5FXJREaFKVVRxfuYPE34a8mevYwBtFyukjumBxcDQtet8ucF
const to = "0x8f29c95dcb1f7cc02c2ada8aa69c89d68b9989829c93e263861cece495b920f0"; // 5CcasPNsfv6kNboToddPjzARZh4eQUhu8uNakUjaj6S9VbGC

const list = [
  "0x74838ff0ff3a88b65fb7f56d0e19ff1514fe0cfd20e1d2bc5194a0e4fa0c10e2",
  "0x0c9ea0e93f8f256125b8c201a050a79729188d9e8aea685ffbe793bfddc68840",
  "0xa09c3c4dfa211b3c853bc6c0da0cffdc15b1dadb882e30f6d05ddfc61c9c2366",
  "0xd99995c4a786c84c9cfd8b508031953fcd720dfb8a3ffe2371695ddb92cd8f23",
  "0x9a02ff65a17e91bd010a4d93935bcfeaad31ada5d5ed8c91157d7fb8c93810ef",
  "0x8a9a75c454dad3faa327f97399f96e5bec4188efc0319fc84a20cb575ca80971",
  "0x726564be94b18d652fcd3b05bdba84ec43b1ffd80de3f25610235c6c1fbbc0e5",
  "0x86e8dd3ed66f1d7a3855ba185928eea6b65adc433e91fd87c6b631cf0b57fb34",
  "0x312f2c0671c170244d2a2a5af820eecf0804d6eae738b1fa4a9ae20bedaf40c2",
  "0xb47964415517b60f3ee41a5cc099e462369466f79081d7c1399db56031549cd3",
  "0xa146272bc41d6591c89dc04cd7411f7d072aa1f434fa46fe347ac652af641945",
  "0x1066b2da25dcfc89b5e6c22336064f4cc9b8af322f3d2c12e175804bdb949fb6",
  "0x90603db99a7a26753428c99b7ef5e84a98ed994967ada63f4d87540e110c29c3",
  "0x13f69eb4d0f456fb11d50d8da3652a9fc1a715db284925ce4f698202ae961de4",
  "0xe0b3fb8aa70b0e80d3e2ee5285f1a858449a1c365ec72fd46884aaab2a481b58",
  "0x8b1475d99dad269a8c36754b9ec2238fb2b951f65761cefffe4cdc5d7de66385",
  "0x170846d29f3179c4d7f2ef52c3f6f5d892420a6a1e765165e3bbcf155a497661",
  "0xa82d8a3bf2b1d296c67832a72e90116b8f4124f7f4658b04f1c25cb2e5edc2f3",
  "0xca4c020ab79a50d9720a964b379b4cd7a6c3478405a2e2d44170a0eb73c233ae",
  "0x7bff3a4047001f4941305f10226be71068c471968f6de5c24da8c67543e9a6ca",
  "0x1955e4191b6287a210dbabb61f91b18afe17c85179438d2dbbf46a4c461f83f0",
  "0xeba8771e4371bfe305abf7d510fb1339f4080fc2fd3a7eb8cc1288ac573a3a55",
  "0xd668018bda13a7f0403485127357974204e7cd4cb033bc441753394de6b73d78",
  "0x570104701cf706659cbac6da578e58435cbbc572d7f7a954f1bc35affaecd649",
  "0xab755084e03683ac2b8f4dbf9b05d166bc2c05bb0b4a5bacf07a320022feaca9",
  "0xd7f3a3a9e92bd640b46ad3038660d0e275a6a0bb6cdec9b997a6ab87e2b7448e",
  "0x92ea2cdaa2226bcf1370e011d9ce929cf5e95dcdbc9d240309e44bcb5ae8e2af",
  "0xabba2d8659408b94e584bd7da15a3855fe8c0fb0893b508154bcd4cc5b9f917e",
  "0xa24c76ad92baaf454840cf77a50f67cb912ac1618b98b4a1de2b7b11d9bc1531",
  "0x22b2a0b0b57d1fe0c7f23d77ba7803636a939941c2f8e701ac19027cce8e9639",
  "0xd23670790e8bee80a9b99c7bcd44e13df7a47227ee9f3a7c69871407388eb254",
  "0x196643dc48ffaf668969ebd79b4f84e0e1abc31cf962f1c92dcab7d87ecabfe5",
  "0xc2ecbba3a0aa6ec9e674d965a2fcbafe45fc3d9fc2c9bfcae9c8de2efcba98f1",
  "0x5ddbddb008b827d298e8af205cfb4ab6ac23c98f7d4a4479971f24c06d7bec6d",
  "0x2c025bd97a6dc1f1531a465398803f6baabe958c8a766a4107c089cabff02420",
  "0x6230b0774b3fc273246fee06fffce37fdd38471bde1efdfc7938abb7cb5dfa89",
  "0x6c877f5f5bca770c9d03ef8ef2670d87a5d7c0eaeecb730fad184354c72dd345",
  "0xf72115be6e3efe8fc42f8a1b04b52f486a08f52f800756be173da47efe59ac15",
  "0xbab849ce8acf55d0f6cd3b55307988c818afe01631ace4f066f72213ce96fb6d",
  "0xd97486f62f92084d51f29dd74f17fa7bcbd7fdfca23c3f5b4853fd322cbf9442",
  "0xb42ce6490b32dd8b4bc662cb1f8bbf7571c90dfaa4cd9193c82985f5807c3ad3",
  "0xeec8c584d96f834114a37e70fd3b1c57c4ef32cbd582d294fad2efd5298e5788",
  "0x4f40f3ad87be502c22bb7a4e97b37dc6811b5d6ea80b62e196384b2007274606",
  "0x38185abd2aa6364507b3c1a9a5b57aa8f98121ac32418667948fc63ed2c77532",
  "0x68ce50555b5f57d8f92f36bed58e33420c55e9b0921d3f13a120a597e43f0d0d",
  "0x439a745efb5f6f08f7f4d46885a078041e03e65e70e4cbcba71460c45254d86d",
  "0xe7f2de6e090866001692e575683092d4ca8e6e5c32f101966c426177ede029d6",
  "0xde606ed44c6705579abbe95e1d05c30a1666e231c76d6ddc4586e29a8fe3a965",
  "0xa809d5b7ad48d101656f1acb2817869b642dccbd560d73ddcc08d6cd499fe428",
  "0xa79a1e3b54b0b7a0a94fdb82d6f1a516f2ae0d449f595d597ec13858119ed468",
  "0x28fa7b56d3242f66f7c307f01856eb656fc8ff8bfbe16fa3f7dc48cf70a69599",
  "0x0a1b96ec2bcdfb36a6aef1221d72cd390c17b75f6e753de7497b55a7f33326c0",
  "0x9d0db983922cc6d46431d20fd460df6e7e8e15ccfb7073e486d87912ca1f6302",
  "0x8c654e9bc6fb9c0844648e9bae0a0e2150e5c60dfe541638e6c1fbba4917041c",
  "0x2323952ecf2b94461d1b07248003c365039d06d7f15bf569e85f6fb594d8bf09",
  "0x8a02ce915a7e50dd538ca0ec33f0e637667eb262e27296090b61da013c433fa7",
  "0x8e1840940563adc2153dfc9d8c660a948b817aadde937997147c983badfc732b",
  "0xed2a6155a80e21ff82259130a1b8c40afe202b1b5a542da9aebc5a3bde97a227",
  "0xd3737b981b9d057615a2b5bea3a277272b14597d46cc305725916b015b8f1333",
  "0xa335561dc3a24cd1f5e6faf4d07f7706a2821b9e28f78c63f2491feba7bee275",
  "0x276380ca74a3916aa8e2819414702de5741beeefce593407f8f9ddff65ab183b",
  "0xc67e5dbfe7e678ce0c91f007211a068b8b090dbefed6b0ebc00aa0181c669b69",
  "0xa0d98661f3fd68542c438fb657aca37b1dea284ac68e3c742d094941b3a29fbe",
  "0xa3e4e7cf4868d9b4a9658f75931a13b66626d3582667ba8ed91dccf303d5b9b3",
  "0x92affc772c24d1a9021afdcd2b776cfe827c8cebea2367ad8caa24ca8d7d8890",
  "0x995b74c2c1667cd3b72aea4c0326b6b41d0964a803a2ee760dc9e0796365bf86",
  "0x39625c002d0da1289e81abe37978071ffeac347aa5e1c8c7280c4f8daf8f73da",
  "0x7031608efd26cbbbc19eba9c3760c38108222164ad6153f34959fbce0938cc02",
  "0x2fd066b0751606d04ee661cc4284d1df1355e7ea9041218b935d03b1bcc35102",
  "0xea096a134d01c349f20b49a725506bfc9b00074cc56e34bf4270d1bbed5c83ba",
  "0x334ff5645575bce5ade6b9a82a3123e938d5101f4dd9279ed6b051d27d7e5bb6",
  "0xe8b6eefe2da2717d8d97d69b7f4b17ed932c07de626fb5b0fb8098ad9cf7cad6",
  "0xb81b01a4cd771ccb18701962dac4df40901edf403f3f8ac893579a09c27a103b",
  "0x51f39dec9f2e02eae9bfb231d5e94baeb75302ee087e6dbdcc86b977405f6836",
  "0xb51608008c934852f26d992a92bfc7c38c57b751079ec9d075f2bf8ee5af0929",
  "0x6b120e66feb24fd8802ecb2cb647a93f9917874bd6e631811cc1bf6063932323",
  "0x216f514a8f8df718b923847b872eadc0f57c9463a8759c47cc5193dd45b12675",
  "0xfa54b532a543b78c14b7868d9e21bbcb7ade4437b8ae5795976ed0eb3301f336",
  "0xb194e751b3ff9dfb54f7248290128d6f11fda50868ece885c9e946acd1d6b503",
  "0xa69d44dfd32ef8c175b56de4fce1e43d2e3fb24eb1ec3cfc2fef6d8d3b47b8a7",
  "0xd6e1bf1f1a75cc3309aefa728a58e04b9f40f7b437269a3cc4e724cfc938ad57",
  "0xc417d7d52fb931ffe0513492d27255a4b85e6aaf7988916166bceea9c39c1dbf",
  "0xe2932fb3b8f94b570af6596398de37326ecb7a051e73566baa9e06d2b2da502e",
  "0x0eddad0221eebd905a6a25477a23c3b3d8e7f2b6bc14577dc052ce1fe79d06f8",
  "0xf2d7e54c3b9877be890741c4f497cfecfda053b14b92c035a5d11eb7e8210dad",
  "0x99ff146ef266bbd0d190be187fd6cd15e6577b3cf01701a91e36472ca2e881b1",
  "0xfa5b4f0bea49bc7400ab21610fb3aab041e30da37e6a994bf18cad680306777c",
  "0x027fe5df83960b54c97810000c7525ea68115329d10c490ecd24cd4d97c15d96",
  "0x8b50554bc77f17615b58bee641639f0dae4a069a243ac34c27216b53f7ff47e7",
  "0x080032cc69814eb4143ef2b448df3bd2e52ce14aa6960f02eb56e90aa8f9054b",
  "0xd6314cb1591111e29441201ec10e95f3fc444b20be9448ac901ff8815be3af91",
  "0xc5fb859f6c3fc738766bee08ed1f6dd98afd62090d8803e05427545a4e6786a1",
  "0xb01f66d9263cc7f3ef935e387da00def38b064be4bf4dbc842555f745cc17690",
  "0x099bfe8466396799a7adf96268b594e628d90881dcc165661e64847409f4d0e1",
  "0x37c5f26104807fa0c7beb26596dff462fc943d84fa03021827b6d3acf0abfe4a",
  "0x3d55223b6b0a41ebf577375a9945bd987356af7a9c5e7474bd5baa3e9378eb17",
  "0xd1b3f0c8473098a33ebb5613698af21ca946e54cca5286ad4c52177445de7eac",
  "0xb65536120369b8cdb50e132490bf881143db78b5f1b9003636dc50012d0c6e99",
  "0xc200baee803cd55b2000606cf5bdfbe29c434cf749ceeb984d16828ccccb783e",
  "0x500c138a883070f11c7d0869cab2a80fcf53df2d17f8d9add9547402401913e9",
  "0x8e9575ed55b07da1531d939998fbbc76afceca4f373ea6067c5b2605d8f666b9",
  "0x4b154a79a00507fdce6219e4be4a9b9a3af24a56ae058a5b9e6472a19064a7f9",
  "0x848a793a057c3ad82ebb29476a57d9614e6c531b89d6f747b68975d995e403f5",
  "0x4979d5652ad06283cb61cd61e50b83630bc3caa5c0977a8ebf75c999868a113d",
  "0xe91fa1d9b56033268f8086ff1e31c6f0f0fff746d49e98ff64396b68399cb274",
  "0x1444084e54ef01563b3c3f79dbc95f950fea8f1386c82eea590e9f274976a9a3",
  "0x58b0d534f6f9fa10ad20a2155ab09b146fc3b79d59a5572c6d83ca8afaecc5f2",
  "0xb3b0ce626c59d5e1cd1473f6cdbec2b35ecfb37f1f77870ac3dc2831c661eb40",
  "0xfffaede76daa8ee66482ad301bf597075399f1f67cb842e6bb04e197c25c2bd2",
  "0x5943b384cb972ffe7da68cd38aedb348042167c9523e7477c529af1b88208c00",
  "0xc25ddb6d6a903bdcb16c9ee3c532d83496435f60b7990f7dfc48bcbe7c09ef61",
  "0x046ae159beb698c14ed20dcac53e8f536522642e54796c8cd1824786e26c8de6",
  "0x5d01fbec989810ea2344948990de6d83ea66ea12a5d59107faa78f095595024d",
  "0xe468b76f106f4d36b088cbd7cfbae09f6112ea411bfb9b9c49724d179287b662",
  "0x1ec44afe9cd99a1c5a4d8fc0e3bd0e5d4b2337e77a1eb27d419f441a67cf3c6f",
  "0x1a23f0d4c0626992bc8f0c626052bbfe25eb5a98e49d2d3c3784088437a61426",
  "0xc50176ea49d9e1fb8fb066d5d14175b6180305f886c8176dec15a4c3111cfe5d",
  "0x7be87399412c176349bdbf7f402345590b04cfdb03c440ac5b47009f4f8ea614",
  "0xcd2832b394264fb1d4d7c2a05c880d395ac5bf71d763e088b6554f9c181f65d8",
  "0x35c9713f81e797459cd06efa64898f3e1791a55e1372226c8698e1d17da36bcc",
  "0x7b322abfe2c163133e8e3750c9ee2fa0a57dc51060b8cd3e41f5408800ba7e87",
  "0x3c915d9630cd266aa34aa58c43d39a7a6b362c2db7a0605831c29280ae6d4e40",
  "0x76251fb3bfa26bb102d0ef45c1d45139d0ce1bc08007e9d6cd609e3dd43f39f7",
  "0x45a2b9a9b97fc0b75cec7449546f0437b236c5e7465dfb469b2a5fc4d3b6870e",
  "0xa6907b9c4b829d781816ae01502542a3210444b9dc23ce443bc19e776175c34a",
  "0x53b68910a1035418cdd4e051fc1db08dcf504e36e6fa96d4e7dcf471fe3ff3c5",
  "0x6ea644f2fe296eba8639a45c9fc4b3dd87c3cfc43d081faeb512dc2ece2a5df4",
  "0x96d32322244b4c304de882f3fa603d5deae252c1cbe3e381195395d872acc8e4",
  "0xf4a6cbd8125abd33f34fd03eee661b41edac9cfa3c37bd75266258f1351c6c62",
  "0xde65abb4fa0bab6e6764127cd529cee39a91bfa2236ff10242a8dc4cb9d48ace",
  "0x07cccf5430c84794c6422844a0f1de30f5fd9e94835c92c6d68da2bc6a42bfa4",
  "0x569c7e687da934427020de5cdcac1b5a5f646244b448a1fc34e660b388c7f793",
  "0x635e9c6aa98b1bc383b1e615df64864d3d614b1b9adda4e43f0068b10b23766f",
  "0x2f564ef3d4288986734e4a262c893fc4625bdeccd90fa92cc114cf008a075245",
  "0x0c6a77376b67e9d6b4737fe8c36d989969878a6db499f1a5dffe7ed6a346abf5",
  "0xb0b3bd304cd5be4773c997daad032807fc159aa1b9a2824e620d9e210e852026",
  "0x0c58290c830b8fff54e36128227638bd85955968e8d9b26a19330a89d0794066",
  "0xe6de336191e694c120f2931e7dd8352f55a79f273ae31dfa1cd4e16db14c4d7f",
  "0xc5e8e0c1370c7d7d89084781cc2863117ad0ad019d5090013529441bd3932b17",
  "0x0900251a06c7476d6b446504fba4c7e5128d10affe12b4068aee22f2f0a9e449",
  "0x2b302757d4691c187c145aea91d662c254d216b3f5ad3cfdccf66926ee6e1a6b",
  "0xed1a56e7435c2f41648d891998c3b47636018c0a7932c59577175bfc33bb4cb8",
  "0xd4628abf9fee5d99adcc9a3eec2bb307687f03fe1bce6fb9189f100ab25683ee",
  "0x34d8f9678fb0b30a986ca82f865babab5a4ea96c79d1b2bb488dbc6cc26b2b15",
  "0xfd0dc242faf4b09e53b1774fc1358ecb08c4a8470111b40f49fcb040189e863f",
  "0xb7bd6889877afff0b35b1585921f08515dfe9351532fd045bfe6568d8b67dece",
  "0x2adba56f4ad825372edef54f976143f278f7b83b47a601c3c951d2d3599109f1",
  "0x8ef5483e76074167eb1fc76aedae60e3e12d4ef1b7584656afda81fe5c824f92",
  "0xee42a2ec061ed7730f7ec15d0f55e7162861c46a7a2f89566ea9bfbea07ff2eb",
  "0x6d7df9f0ca69f92c0a465eb7250c43b4286fbb93505dee96cabe8c845c71b410",
];

const countTransferEvent = async () => {
  for (let i = 0; i < list.length; i++) {
    setTimeout(async () => {
      const res = await axios.post(
        "https://polkadot.api.subscan.io/api/scan/extrinsic",
        {
          hash: list[i],
        }
      );

      const extrinsic = res.data.data;
      const transferEvent = extrinsic.event.filter(
        (e) => e.event_id === "Transfer"
      );
      console.log("count", transferEvent.length);
    }, 1000);
  }
};

countTransferEvent();
